<!doctype html><meta charset=utf-8>
<meta name=viewport content="width=device-width, height=device-height, initial-scale=1" id=$viewport>
<title>markdown preview</title>

<script>
	if (CSS.supports('-webkit-touch-callout', 'none')) // iOS safari
		document.querySelector('meta[name=viewport]').content += ", user-scalable=no"
</script>

<script src=textarea.js></script>
<link rel=icon sizes=any href='data:image/svg+xml,<svg viewBox="-769 -553, 1538 1106" xmlns="http://www.w3.org/2000/svg"><path fill="rgb(191,186,181)" transform="rotate(-15)" d="M0-523C-431-523-779-349-779-0S-431+523+0+523S779+349+779+0S431-523-0-523z"/></svg>'>

<link rel=stylesheet href=res/fonts.css>
<link rel=preload as=style href=res/sort.css>

<style>
	:root {
		overflow-wrap: break-word;
		--color-foreground: rgb(131,37,79);
		--header-size: 4rem;
		font-family: Atkinson Hyperlegible,ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,segoe ui,Roboto,helvetica neue,Arial,noto sans,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol,noto color emoji;
	}
	
	textarea-container {
		font: condensed 14px / 1.25 league mono;
		line-break: anywhere;
	}
	textarea {

	}
	
	input:not([type]), textarea { 
		outline-color: rgb(130,127,124);
		outline-style: dashed;
		outline-width: 1px;
		outline-offset: 0.25rem;
	}
	input:not([type]):focus, textarea:focus {
		outline-style: solid;
		outline-width: 2px;
		outline-color: var(--color-foreground);
	}
	
	input[type=checkbox] {
		background-color: rgb(255,249,242);
		color: var(--color-foreground);
	}
	
	a {
		color: unset;
		text-decoration: unset;
		cursor: pointer;
	}
	a:hover {
		text-decoration: underline;
	}
	
	.outer {
		background: white;
		box-shadow:
			0 4px 5px rgba(25,25,25,0.14),
			0 1px 10px rgba(25,25,25,0.12),
			0 2px 4px rgba(0,0,0,0.2);
		border-radius: 0.5rem;
		overflow: hidden;
		display: flex;
		flex-flow: column;
	}
	.outer > :first-child, .outer > :last-child {
		background: rgb(255,249,242);
		padding: .75rem;
		display: flex;
		flex-flow: wrap;
		line-height: 1;
		gap: 0.5rem;
		align-items: center;
	}
	.outer > :first-child {
	}
	.outer > :last-child {
	}
	.outer hr {
		height: 1px;
		border: none;
		background: rgb(191,186,181);
		margin: 0 0.75rem;
		flex: none;
	}
	.row > hr {
		height: unset;
		width: 1px;
		margin: 0;
		flex: none;
	}
	.row > * {
		flex: none;
		min-width: 0;
	}
	.col {
		display: flex;
		flex-flow: column;
	}
	.col > * {
		flex: none;
		min-height: 0;
	}
	.avatar {
		width: 2rem;
		height: 2rem;
		background: gray;
		clip-path: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg"><clipPath id="clip-squircle" clipPathUnits="objectBoundingBox"><path d="M .5 0 C .9 0 1 .1 1 .5 S .9 1 .5 1 0 .9 0 .5 .1 0 .5 0 z"/></clipPath></svg>#clip-squircle');
	}
	.name {
		color: rgb(25,25,25);
		font-weight: bold;
	}
	.handle {
		color: rgb(104,102,100);
	}
	.time {
		color: rgb(130,127,124);
		font-variant-numeric: tabular-nums;
		font-size: 0.75rem;
		line-height: 1rem;
	}
	.icon {
		width: 24px;
		height: 24px;
	}
	
	.split {
		display: grid;
		grid-template-columns: 1fr auto 1fr;
	}
	
	.outer input:not([type]) {
		appearance: none;
		border: none;
		color: inherit;
		background: none;
		font: inherit;
		width: 100%;
		padding: 0;
		box-sizing: border-box;
		flex: 1;
	}
	
	.post {
		background: white;
		overflow-y: auto;
	}
	
	pre {
		white-space: pre-wrap;
		line-break: anywhere;
	}
	body, html {
		background: rgb(255,249,242);
	}
	html {
		overflow-y:scroll;
		min-height: 120%;
	}
	/* usually i wouldn't use position:fixed headers but */
	header {
		height: var(--header-size);
		z-index: 10;
		top: 0;
		left: 0;
		right: 0;
		position: fixed;
		background-color: var(--color-foreground);
		color: white;
		box-sizing: border-box;
		border: 1px transparent solid;
		
		display: flex;
		flex-flow: wrap;
		line-height: 1;
		gap: 0.5rem;
		align-items: center;
	}
	header .time {
		color: #EEE;
	}
	main {
		margin-top: var(--header-size);
		padding: 1rem 0;
	}
	.line {
		overflow: hidden;
		white-space: pre;
	}
	.line::before {
		content: "";
	}
</style>

<body>

<header class='row'>
	<div class='col' style='width:4em;align-items:flex-end;'>
		<button id=$go>render</button>
		<label>auto:<input type=checkbox checked id=$auto></label>
		<time class='time line' id=$time>time</time>
	</div>
	<pre id=$warn style='margin:0;margin-left:auto;height:100%;overflow-y:scroll;flex:0 1 50%;box-sizing:border-box;'></pre>
</header>

<main>
<div class='outer'>
	<div class='row'>
	</div>
	<hr>
	<div class='split row'>
		<textarea-container class='limit'>
			<textarea id=$in placeholder="Post body (accepts markdown 🥴)"></textarea>
		</textarea-container>
		<hr>
		<div class='post' id=$host></div>
	</div>
	<hr>
	<div>
	</div>
</div>

<pre id=$out2></pre>

<script type=module>
	import process from './main.js'
	
	let style = document.createElement('link')
	style.rel = 'stylesheet'
	style.href = 'res/sort.css'
	
	let prose = document.createElement('div')
	prose.className = 'prose'
	
	let sh = $host.attachShadow({mode:'open'})
	sh.append(style, prose)
	
	function warn(msg) {
		$warn.textContent += "⚠️"+msg+"\n"
	}
	
	window.run = ()=>{
		$warn.textContent = ""
		let p = performance.now()
		let out = process($in.value, {warn})
		prose.replaceChildren(out)
		let p3 = performance.now()
		let t1 = p3-p
		$time.textContent = t1.toFixed(1)+" ms"
		$out2.textContent = prose.innerHTML.replace(/\n/g, '⤶\n')
	}
	
	setup_textarea($in, ()=>{
		if ($auto.checked && window.run)
			run()
	})
	
	$go.onclick = run
	run()
</script>
